(()=>{"use strict";const e=window.React,{registerPlugin:t}=wp.plugins,{PluginSidebar:r,PluginSidebarMoreMenuItem:a}=wp.editPost,{Button:s,TextareaControl:n,Spinner:l}=wp.components,{Fragment:d,useState:i,useRef:o,useEffect:c}=wp.element,{useDispatch:u}=wp.data,{createBlock:m}=wp.blocks;t("builder-buddy-sidebar",{render:()=>{const[t,m]=i(""),[y,b]=i([{sender:"assistant",text:'ðŸ‘‹ Hello! I\'m Builder Buddy, your friendly Assistant Sidebar. You can chat with me here.  \n\nTo search your site, type **"please search"** followed by your query, for example:  \n\n`please search accessibility`  \n\nIâ€™ll show you the top 3 search results.'}]),[p,h]=i(!1),w=o(null),{editPost:C}=u("core/editor");c(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[y,p]);const g=async()=>{if(!t.trim())return;const r=t.trim();b(e=>[...e,{sender:"user",text:r}]),m(""),h(!0);try{const t=await fetch(builderBuddyData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({action:"ask_builder_buddy",nonce:builderBuddyData.nonce,message:r})});if(!t.ok)throw new Error(`HTTP ${t.status}`);const a=await t.json();if(!a.success||!a.data)throw new Error("Invalid response from API");const s=a.data;if(!s||"object"!=typeof s)throw new Error("Invalid response format");console.log(s);const n=s.answer||"ðŸ¤” I wasnâ€™t able to find an answer for that.",l=Array.isArray(s.sources)?s.sources:[],d=[];if(d.push((0,e.createElement)("div",null,(0,e.createElement)("p",{style:{whiteSpace:"pre-wrap"}},n))),l.length>0){const t=l.map((t,r)=>(0,e.createElement)("div",{key:r,className:"builder-buddy-source"},"ðŸ“š ",(0,e.createElement)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},t.title||"Untitled source")));d.push((0,e.createElement)("div",{style:{marginTop:"10px"}},(0,e.createElement)("strong",null,"Sources:"),(0,e.createElement)("div",null,t)))}b(e=>[...e,{sender:"assistant",text:d}])}catch(e){console.error("Builder Buddy request failed:",e),b(e=>[...e,{sender:"assistant",text:"âš ï¸ Sorry, I had trouble reaching the Builder Buddy service. Please try again."}])}h(!1)},f=(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"mdi-clippy",viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor"},(0,e.createElement)("path",{d:"M15,15.5A2.5,2.5 0 0,1 12.5,18A2.5,2.5 0 0,1 10,15.5V13.75A0.75,0.75 0 0,1 10.75,13A0.75,0.75 0 0,1 11.5,13.75V15.5A1,1 0 0,0 12.5,16.5A1,1 0 0,0 13.5,15.5V11.89C12.63,11.61 12,10.87 12,10C12,8.9 13,8 14.25,8C15.5,8 16.5,8.9 16.5,10C16.5,10.87 15.87,11.61 15,11.89V15.5M8.25,8C9.5,8 10.5,8.9 10.5,10C10.5,10.87 9.87,11.61 9,11.89V17.25A3.25,3.25 0 0,0 12.25,20.5A3.25,3.25 0 0,0 15.5,17.25V13.75A0.75,0.75 0 0,1 16.25,13A0.75,0.75 0 0,1 17,13.75V17.25A4.75,4.75 0 0,1 12.25,22A4.75,4.75 0 0,1 7.5,17.25V11.89C6.63,11.61 6,10.87 6,10C6,8.9 7,8 8.25,8M10.06,6.13L9.63,7.59C9.22,7.37 8.75,7.25 8.25,7.25C7.34,7.25 6.53,7.65 6.03,8.27L4.83,7.37C5.46,6.57 6.41,6 7.5,5.81V5.75A3.75,3.75 0 0,1 11.25,2A3.75,3.75 0 0,1 15,5.75V5.81C16.09,6 17.04,6.57 17.67,7.37L16.47,8.27C15.97,7.65 15.16,7.25 14.25,7.25C13.75,7.25 13.28,7.37 12.87,7.59L12.44,6.13C12.77,6 13.13,5.87 13.5,5.81V5.75C13.5,4.5 12.5,3.5 11.25,3.5C10,3.5 9,4.5 9,5.75V5.81C9.37,5.87 9.73,6 10.06,6.13M14.25,9.25C13.7,9.25 13.25,9.59 13.25,10C13.25,10.41 13.7,10.75 14.25,10.75C14.8,10.75 15.25,10.41 15.25,10C15.25,9.59 14.8,9.25 14.25,9.25M8.25,9.25C7.7,9.25 7.25,9.59 7.25,10C7.25,10.41 7.7,10.75 8.25,10.75C8.8,10.75 9.25,10.41 9.25,10C9.25,9.59 8.8,9.25 8.25,9.25Z"}));return(0,e.createElement)(d,null,(0,e.createElement)(a,{target:"builder-buddy-sidebar",icon:f},"Builder Buddy"),(0,e.createElement)(r,{name:"builder-buddy-sidebar",title:"Builder Buddy",icon:f},(0,e.createElement)("div",{className:"builder-buddy-sidebar"},(0,e.createElement)("div",{ref:w,className:"builder-buddy-chat-area"},y.map((t,r)=>(0,e.createElement)("div",{key:r,className:"builder-buddy-chat-message "+("user"===t.sender?"builder-buddy-user-message":"builder-buddy-assistant-message")},(t.text,t.text))),p&&(0,e.createElement)("div",{className:"builder-buddy-typing-indicator"},(0,e.createElement)(l,null)," Assistant is typingâ€¦")),(0,e.createElement)("div",{className:"builder-buddy-input-area"},(0,e.createElement)(n,{value:t,onChange:m,placeholder:"Type your message...",rows:2,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())}}),(0,e.createElement)(s,{className:"builder-buddy-send-button",variant:"primary",onClick:g},"Send")))))}})})();